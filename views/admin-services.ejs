<%- include('partials/header') %>

<section class="admin-section">
  <div class="service-wizard-container">
    <div class="wizard-header">
      <h1>Services Moderation</h1>
      <p>Review, hide, delete, or edit posted services</p>
    </div>

    <form method="GET" action="/admin/services" style="margin-bottom:16px;display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
      <input type="text" name="q" placeholder="Search title or owner" value="<%= q || '' %>" class="form-control" style="max-width:280px;">
      <select name="status" class="form-control" style="max-width:200px;">
        <option value="" <%= !status ? 'selected' : '' %>>All statuses</option>
        <option value="active" <%= status==='active' ? 'selected' : '' %>>Active</option>
        <option value="hidden" <%= status==='hidden' ? 'selected' : '' %>>Hidden</option>
        <option value="deleted" <%= status==='deleted' ? 'selected' : '' %>>Deleted</option>
      </select>
      <button class="btn-primary" type="submit" style="flex:0 0 auto;">Filter</button>
    </form>

    <div class="wizard-content active" style="display:block">
      <% if (services && services.length) { %>
        <div style="overflow:auto;">
          <table style="width:100%;border-collapse:collapse;">
            <thead>
              <tr style="text-align:left;border-bottom:2px solid #e5e7eb;">
                <th style="padding:10px;">ID</th>
                <th style="padding:10px;">Title</th>
                <th style="padding:10px;">Owner</th>
                <th style="padding:10px;">Status</th>
                <th style="padding:10px;">Price</th>
                <th style="padding:10px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% services.forEach(function(s){ %>
                <tr style="border-bottom:1px solid #f3f4f6;">
                  <td style="padding:10px;">#<%= s.id %></td>
                  <td style="padding:10px;max-width:360px;">
                    <a href="/services/<%= s.id %>" target="_blank" style="font-weight:700;color:#111827;text-decoration:none;"><%= s.title %></a>
                    <div style="color:#6b7280;font-size:12px;margin-top:4px;"><%= (s.description||'').slice(0,100) %><%= (s.description||'').length>100?'…':'' %></div>
                  </td>
                  <td style="padding:10px;"><%= s.full_name %> <br><span style="color:#6b7280;font-size:12px;"><%= s.email %></span></td>
                  <td style="padding:10px;"><span class="review-badge"><%= s.status %></span></td>
                  <td style="padding:10px;">$<%= s.price_per_hour %>/hr</td>
                  <td style="padding:10px;white-space:nowrap;">
                    <form method="POST" action="/admin/services/<%= s.id %>/hide" style="display:inline-block;vertical-align:top;">
                      <label style="font-size:12px;color:#6b7280;display:block;">
                        <input type="checkbox" name="notifyInApp" checked> In‑app
                      </label>
                      <label style="font-size:12px;color:#6b7280;display:block;">
                        <input type="checkbox" name="notifyEmail"> Email
                      </label>
                      <button class="btn-secondary" <%= s.status==='hidden'?'disabled':'' %> title="Hide" style="margin-top:4px;">Hide</button>
                    </form>
                    <form method="POST" action="/admin/services/<%= s.id %>/unhide" style="display:inline-block;vertical-align:top;margin-left:6px;">
                      <label style="font-size:12px;color:#6b7280;display:block;">
                        <input type="checkbox" name="notifyInApp" checked> In‑app
                      </label>
                      <label style="font-size:12px;color:#6b7280;display:block;">
                        <input type="checkbox" name="notifyEmail"> Email
                      </label>
                      <button class="btn-secondary" <%= s.status==='active'?'disabled':'' %> title="Unhide" style="margin-top:4px;">Unhide</button>
                    </form>
                    <form method="POST" action="/admin/services/<%= s.id %>/delete" style="display:inline-block;vertical-align:top;margin-left:6px;" onsubmit="return confirm('Delete this service?');">
                      <label style="font-size:12px;color:#6b7280;display:block;">
                        <input type="checkbox" name="notifyInApp" checked> In‑app
                      </label>
                      <label style="font-size:12px;color:#6b7280;display:block;">
                        <input type="checkbox" name="notifyEmail"> Email
                      </label>
                      <input class="form-control" name="reason" placeholder="Reason" style="margin-top:4px;max-width:220px;" />
                      <button class="btn-secondary" title="Delete" style="margin-top:4px;">Delete</button>
                    </form>
                    <% if (authUser && (authUser.role==='super_admin' || authUser.role==='global_admin')) { %>
                      <details style="display:inline-block;margin-left:8px;">
                        <summary class="btn-primary" style="display:inline-block;padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer;">Edit</summary>
                        <form method="POST" action="/admin/services/<%= s.id %>/edit" style="background:#f9fafb;padding:12px;border-radius:8px;margin-top:8px;min-width:360px;">
                          <input class="form-control" name="title" placeholder="Title" value="<%= s.title %>" style="margin-bottom:6px;" />
                          <textarea class="form-control" name="description" placeholder="Description" rows="2" style="margin-bottom:6px;"><%= s.description %></textarea>
                          <div style="display:flex;gap:6px;">
                            <input class="form-control" name="price_per_hour" type="number" step="1" min="0" placeholder="Price/hr" value="<%= s.price_per_hour %>">
                            <input class="form-control" name="duration_minutes" type="number" step="15" min="15" placeholder="Duration (min)" value="<%= s.duration_minutes %>">
                          </div>
                          <div style="display:flex;gap:6px;margin-top:6px;">
                            <input class="form-control" name="category" placeholder="Category" value="<%= s.category %>">
                            <input class="form-control" name="format" placeholder="Format" value="<%= s.format %>">
                          </div>
                          <div style="display:flex;gap:6px;margin-top:6px;">
                            <input class="form-control" name="location" placeholder="Location" value="<%= s.location || '' %>">
                            <input class="form-control" name="tags" placeholder="Tags" value="<%= s.tags || '' %>">
                          </div>
                          <label style="display:flex;align-items:center;gap:6px;margin-top:8px;"><input type="checkbox" name="notifyInApp" checked> Notify in app</label>
                          <label style="display:flex;align-items:center;gap:6px;margin-top:4px;"><input type="checkbox" name="notifyEmail"> Notify by email</label>
                          <div class="wizard-nav" style="border-top:0;margin-top:8px;">
                            <button class="btn-success" type="submit">Save</button>
                          </div>
                        </form>
                      </details>
                    <% } %>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="wizard-content" style="display:block;text-align:center;">No services found.</div>
      <% } %>
    </div>
  </div>
</section>

<%- include('partials/footer') %>
