<%- include('partials/header') %>

<div class="page-header">
    <h1>Careers at Dream X</h1>
    <p class="subtitle">Join us in building the future of productive social networking</p>
</div>

<div class="content-section">
    <div class="content-block">
        <h2>Why Join Dream X?</h2>
        <p>At Dream X, we're on a mission to create a social network that actually makes people better. We're building a platform where productivity meets community, where growth is celebrated, and where every user becomes the best version of themselves.</p>
        <p>We're a team of passionate builders, designers, and dreamers who believe in the power of consistent progress. If you're addicted to growth and want to help millions of people achieve their goals, you belong here.</p>
    </div>

    <div class="content-block">
        <h2>Our Values</h2>
        <ul class="philosophy-list">
            <li><strong>Growth Mindset:</strong> We believe everyone can improve, including ourselves. We embrace challenges and learn from failures.</li>
            <li><strong>User First:</strong> Every decision we make starts with "How does this help our users grow?"</li>
            <li><strong>Transparency:</strong> We communicate openly, share knowledge freely, and build in public.</li>
            <li><strong>Quality Over Speed:</strong> We ship when it's ready, not when it's rushed.</li>
            <li><strong>Diversity & Inclusion:</strong> The best ideas come from diverse perspectives. We build for everyone.</li>
        </ul>
    </div>

    <div class="content-block highlight-block">
        <h2>üåü The 25% Time Philosophy</h2>
        <p>At Dream X, we practice what we preach. Just as our platform encourages users to pursue their passions and grow continuously, we extend the same principle to our team.</p>
        
        <div class="time-philosophy">
            <div class="time-stat">
                <div class="stat-number">25%</div>
                <div class="stat-label">Free Time</div>
            </div>
            <div class="time-description">
                <h3>Invest in Yourself, On Company Time</h3>
                <p>Every week, you'll have <strong>25% of your work time (roughly one full day)</strong> dedicated to personal and professional development. This isn't vacation or break time‚Äîit's intentional growth time built into your role.</p>
                
                <h4>What can you do with your 25% time?</h4>
                <ul>
                    <li><strong>Learn New Skills:</strong> Take online courses, attend workshops, or practice a new programming language</li>
                    <li><strong>Side Projects:</strong> Build something you're passionate about, experiment with new technologies</li>
                    <li><strong>Creative Pursuits:</strong> Work on music, art, writing, or any creative hobby that fuels your inspiration</li>
                    <li><strong>Physical & Mental Health:</strong> Exercise, meditate, take a long walk, or pursue fitness goals</li>
                    <li><strong>Community Contribution:</strong> Contribute to open source, mentor others, or teach a skill</li>
                    <li><strong>Innovation Time:</strong> Experiment with ideas that could benefit Dream X or solve problems you've noticed</li>
                    <li><strong>Reading & Research:</strong> Deep dive into topics that interest you, stay current with industry trends</li>
                </ul>

                <h4>Why we do this:</h4>
                <p>We believe that the best employees aren't just skilled workers‚Äîthey're well-rounded humans with diverse interests and continuous curiosity. By investing in your growth, we create:</p>
                <ul>
                    <li>üß† <strong>Better Coworkers:</strong> Learning new skills makes you more creative, empathetic, and collaborative</li>
                    <li>üí° <strong>Innovation:</strong> Many of our best features have come from 25% time experiments</li>
                    <li>üéØ <strong>Reduced Burnout:</strong> Regular breaks for passion projects keep you energized and engaged</li>
                    <li>üöÄ <strong>Career Growth:</strong> Continuous learning accelerates your professional development</li>
                    <li>ü§ù <strong>Cultural Alignment:</strong> You experience firsthand what our users experience on Dream X</li>
                </ul>

                <div class="philosophy-quote">
                    <p>"We don't just build a platform for growth‚Äîwe live it. Your 25% time is protected, encouraged, and celebrated. It's not a perk; it's a core part of how we work."</p>
                    <cite>‚Äî Dream X Leadership Team</cite>
                </div>
            </div>
        </div>
    </div>

    <div class="content-block jobs-section">
        <h2>Open Positions</h2>
        <div class="job-listings">
            <% if (jobs && jobs.length) { %>
                <% jobs.forEach(job => { %>
                    <div class="job-card fancy-card">
                        <div class="job-card-top">
                            <div>
                                <p class="job-badge"><%= (job.priority || 'Open').toUpperCase() %></p>
                                <h3><%= job.title %></h3>
                                <p class="job-location"><%= job.location || 'Flexible location' %></p>
                            </div>
                            <div class="job-meta">
                                <span><%= job.workplace_type || 'Remote friendly' %></span>
                                <span><%= job.employment_type || 'Full-time' %></span>
                                <% if (job.seniority) { %><span><%= job.seniority %></span><% } %>
                            </div>
                        </div>
                        <p class="job-description"><%= job.headline || job.description || 'Help us invent the next era of productive social networking.' %></p>
                        <% if (job.description) { %>
                          <div class="job-section">
                            <h4>About the role</h4>
                            <p><%= job.description %></p>
                          </div>
                        <% } %>
                        <% if (job.responsibilities) { %>
                          <div class="job-section">
                            <h4>Responsibilities</h4>
                            <p><%= job.responsibilities %></p>
                          </div>
                        <% } %>
                        <% if (job.requirements) { %>
                          <div class="job-section">
                            <h4>Requirements</h4>
                            <p><%= job.requirements %></p>
                          </div>
                        <% } %>
                        <% if (job.perks) { %>
                          <div class="job-section">
                            <h4>Perks</h4>
                            <p><%= job.perks %></p>
                          </div>
                        <% } %>
                        <div class="job-tags pill-row">
                            <% if (job.tags && job.tags.length) { job.tags.forEach(t => { %>
                                <span class="tag"><%= t %></span>
                            <% }) } %>
                            <% if (!job.tags || !job.tags.length) { %><span class="tag">Dream X</span><% } %>
                            <% if (job.team) { %><span class="tag"><%= job.team %></span><% } %>
                            <% if (job.employment_type) { %><span class="tag"><%= job.employment_type %></span><% } %>
                            <% if (job.seniority) { %><span class="tag"><%= job.seniority %></span><% } %>
                            <% if (job.workplace_type) { %><span class="tag"><%= job.workplace_type %></span><% } %>
                        </div>
                        <div class="job-extras">
                            <% if (job.salary_min || job.salary_max) { %>
                                <div class="pill subtle"><%= (job.salary_currency || '') %> <%= job.salary_min || '' %><%= job.salary_max ? ' - ' + job.salary_max : '' %></div>
                            <% } %>
                            <% if (job.assets && job.assets.length) { %>
                                <div class="pill subtle">Downloads: <%= job.assets.length %></div>
                            <% } %>
                            <% if (job.visibility === 'internal') { %>
                                <div class="pill subtle">Internal</div>
                            <% } %>
                        </div>
                        <% if (job.assets && job.assets.length) { %>
                            <div class="job-downloads-row">
                                <% job.assets.forEach(asset => { %>
                                    <a class="chip-link" href="<%= asset.file_path %>" download><%= asset.label || asset.file_name %></a>
                                <% }) %>
                            </div>
                        <% } %>
                        <div class="job-actions-row">
                            <% if (job.apply_url) { %>
                              <a href="<%= job.apply_url %>" target="_blank" rel="noopener" class="btn btn-primary">Apply Externally</a>
                            <% } else { %>
                              <a href="#"
                                 class="btn btn-primary"
                                 data-meta="<%- JSON.stringify({ description: job.description, responsibilities: job.responsibilities, requirements: job.requirements, perks: job.perks }).replace(/"/g,'&quot;').replace(/</g,'\\u003c') %>"
                                 onclick="event.preventDefault(); const metaStr=this.dataset.meta; const meta=metaStr?JSON.parse(metaStr):null; openCareerForm('<%= job.title.replace(/'/g, "\\'") %>', meta);">
                                 Apply Now
                              </a>
                            <% } %>
                            <div class="pill subtle">Updated: <%= new Date(job.updated_at || job.created_at).toLocaleDateString() %></div>
                        </div>
                    </div>
                <% }) %>
            <% } else { %>
                <div class="job-card">
                    <div class="job-header">
                        <h3>We are opening new roles soon</h3>
                        <span class="job-location">Join early</span>
                    </div>
                    <p class="job-description">No public roles yet. Send a general application and we will route it to the right crew‚Äîattachments welcome.</p>
                    <a href="#" class="btn btn-primary" onclick="event.preventDefault(); openCareerForm('General Application')">Send General Application</a>
                </div>
            <% } %>
        </div>
    </div>

    <div class="content-block">
        <h2>Benefits & Perks</h2>
        <div class="benefits-grid">
            <div class="benefit-item">
                <div class="benefit-icon">üí∞</div>
                <h3>Competitive Salary</h3>
                <p>Market-rate compensation with equity options</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üè•</div>
                <h3>Health Insurance</h3>
                <p>Comprehensive medical, dental, and vision coverage</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üå¥</div>
                <h3>Unlimited PTO</h3>
                <p>Take the time you need to recharge</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üíª</div>
                <h3>Equipment Budget</h3>
                <p>$3,000 to set up your perfect workspace</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üìö</div>
                <h3>Learning Budget</h3>
                <p>$1,500/year for courses, books, and conferences</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üè†</div>
                <h3>Remote First</h3>
                <p>Work from anywhere with flexible hours</p>
            </div>
        </div>
    </div>

    <div class="content-block cta-block">
        <h2>Don't see the perfect role?</h2>
        <p>We're always looking for talented people who share our passion for growth. Send us your resume and tell us what you'd love to work on.</p>
        <button class="btn btn-primary" onclick="openCareerForm('General Application')">Send General Application</button>
    </div>
</div>

<!-- Career Application Modal (Wizard) -->
<div id="careerModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="modal-close" onclick="closeCareerForm()">&times;</span>
        <h2>Apply for <span id="positionTitle"></span></h2>
        <div id="roleContext" class="role-context" style="display:none;">
            <div class="context-block" id="ctxDescription" style="display:none;">
                <h4>About this role</h4>
                <p></p>
            </div>
            <div class="context-block" id="ctxResponsibilities" style="display:none;">
                <h4>Responsibilities</h4>
                <p></p>
            </div>
            <div class="context-block" id="ctxRequirements" style="display:none;">
                <h4>Requirements</h4>
                <p></p>
            </div>
            <div class="context-block" id="ctxPerks" style="display:none;">
                <h4>Perks</h4>
                <p></p>
            </div>
        </div>
        <div class="wizard">
            <div class="wizard-steps">
                <div class="wizard-step-indicator" data-step="1">1. Info</div>
                <div class="wizard-step-indicator" data-step="2">2. Letter</div>
                <div class="wizard-step-indicator" data-step="3">3. Upload</div>
            </div>
            <form id="careerForm" class="career-application-form" enctype="multipart/form-data">
                <input type="hidden" id="position" name="position" />

                <div class="wizard-pane" data-step="1">
                    <div class="form-row">
                        <label for="applicantName" class="form-label">Full Name *</label>
                        <input type="text" id="applicantName" name="name" class="form-input" required />
                    </div>
                    <div class="form-row">
                        <label for="applicantEmail" class="form-label">Email Address *</label>
                        <input type="email" id="applicantEmail" name="email" class="form-input" required />
                    </div>
                    <div class="form-row">
                        <label for="applicantPhone" class="form-label">Phone Number</label>
                        <input type="tel" id="applicantPhone" name="phone" class="form-input" />
                    </div>
                </div>

                <div class="wizard-pane" data-step="2" style="display:none;">
                    <div class="form-row">
                        <label for="coverLetter" class="form-label">Cover Letter / Why You? *</label>
                        <textarea id="coverLetter" name="coverLetter" rows="8" class="form-textarea" placeholder="Tell us why you're a great fit for this role..." required></textarea>
                        <small class="hint">Be specific. Reference past projects, relevant outcomes, and what excites you about Dream X.</small>
                    </div>
                </div>

                <div class="wizard-pane" data-step="3" style="display:none;">
                    <div class="form-row">
                        <label for="resumeFile" class="form-label">Resume/CV (PDF, DOC, DOCX)</label>
                        <input type="file" id="resumeFile" name="resumeFile" accept=".pdf,.doc,.docx" class="form-input" />
                        <small class="hint">PDF preferred. Max 15MB.</small>
                    </div>
                    <div class="form-row">
                        <label for="portfolioFile" class="form-label">Portfolio (ZIP or Images)</label>
                        <input type="file" id="portfolioFile" name="portfolioFile" accept=".zip,.png,.jpg,.jpeg,.webp" class="form-input" />
                        <small class="hint">Optional. Upload a ZIP or a representative image.</small>
                    </div>
                </div>

                <div class="wizard-actions">
                    <button type="button" class="btn-light" id="btnBack" onclick="prevStep()">Back</button>
                    <div class="spacer"></div>
                    <button type="button" class="btn-primary" id="btnNext" onclick="nextStep()">Next</button>
                    <button type="submit" class="btn-primary" id="btnSubmit" style="display:none;">Submit Application</button>
                </div>
            </form>
            <div id="careerFormMessage" style="display: none;"></div>
        </div>
    </div>
    </div>

<style>
.job-listings {
    display: grid;
    gap: 2rem;
    margin-top: 2rem;
}

.job-card {
    background: var(--bg-white);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 2rem;
    transition: all 0.3s ease;
}

.job-card:hover {
    border-color: var(--primary-color);
    box-shadow: 0 8px 24px rgba(255, 79, 163, 0.15);
    transform: translateY(-2px);
}

.job-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.fancy-card {
    border: none;
    background: linear-gradient(135deg, rgba(102,126,234,0.08), rgba(255,79,163,0.08));
    box-shadow: 0 12px 36px rgba(0,0,0,0.08);
    position: relative;
    overflow: hidden;
}

.fancy-card::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 20% 20%, rgba(255,79,163,0.08), transparent 40%);
    pointer-events: none;
}

.job-card-top {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
}

.job-badge {
    margin: 0 0 6px 0;
    padding: 6px 10px;
    border-radius: 12px;
    background: #fff;
    display: inline-flex;
    font-weight: 800;
    color: #312e81;
    border: 1px solid rgba(102,126,234,0.2);
    text-transform: uppercase;
    font-size: 12px;
}

.job-meta {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    font-weight: 700;
    color: #4b5563;
}

.job-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--text-dark);
}

.job-location {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 600;
}

.job-description {
    margin: 1rem 0 1.5rem;
    line-height: 1.7;
    color: var(--text-light);
}

.job-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
}

.tag {
    background: var(--bg-light);
    color: var(--text-dark);
    padding: 0.35rem 0.85rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.pill-row { margin-bottom: 0.75rem; }

.pill.subtle {
    padding: 0.45rem 0.75rem;
    border-radius: 999px;
    background: rgba(255,255,255,0.7);
    border: 1px solid rgba(102,126,234,0.15);
    font-weight: 700;
    color: #1f2937;
}

.job-extras {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin: 0.25rem 0 0.75rem;
}

.job-downloads-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 0.75rem;
}

.chip-link {
    padding: 6px 10px;
    border-radius: 12px;
    background: #fff;
    border: 1px dashed #d1d5db;
    color: #0f172a;
    font-weight: 700;
}

.job-actions-row {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: space-between;
}

.job-section {
    background: #fff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 0.85rem 1rem;
    margin: 0.5rem 0;
}

.job-section h4 {
    margin: 0 0 0.25rem 0;
    font-size: 1rem;
    color: #111827;
}

.job-section p {
    margin: 0;
    color: #4b5563;
    line-height: 1.5;
}

.benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.benefit-item {
    text-align: center;
}

.benefit-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.benefit-item h3 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
}

.benefit-item p {
    color: var(--text-light);
    font-size: 0.95rem;
}

.cta-block {
    text-align: center;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(255, 79, 163, 0.1));
    padding: 3rem;
    border-radius: var(--radius-lg);
}

/* 25% Time Philosophy Styles */
.highlight-block {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(255, 79, 163, 0.08));
    border: 2px solid rgba(255, 79, 163, 0.2);
    border-radius: var(--radius-lg);
    padding: 3rem;
}

.highlight-block h2 {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--text-dark);
    text-align: center;
}

.time-philosophy {
    display: flex;
    gap: 3rem;
    margin-top: 2rem;
    align-items: flex-start;
}

.time-stat {
    flex-shrink: 0;
    text-align: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 2.5rem 2rem;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    min-width: 180px;
}

.stat-number {
    font-size: 4rem;
    font-weight: 900;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 1.2rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.time-description {
    flex: 1;
}

.time-description h3 {
    font-size: 1.6rem;
    margin-bottom: 1rem;
    color: var(--text-dark);
}

.time-description h4 {
    font-size: 1.2rem;
    margin: 2rem 0 1rem;
    color: var(--text-dark);
    font-weight: 700;
}

.time-description p {
    line-height: 1.8;
    margin-bottom: 1rem;
    color: var(--text-light);
}

.time-description ul {
    margin: 1rem 0 1.5rem 1.5rem;
    line-height: 1.8;
}

.time-description li {
    margin-bottom: 0.75rem;
    color: var(--text-light);
}

.time-description strong {
    color: var(--text-dark);
    font-weight: 700;
}

.philosophy-quote {
    background: white;
    border-left: 4px solid var(--primary-color);
    padding: 1.5rem 2rem;
    margin: 2rem 0;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.philosophy-quote p {
    font-size: 1.1rem;
    font-style: italic;
    color: #1f2937;
    margin-bottom: 0.5rem;
    line-height: 1.7;
}

.philosophy-quote cite {
    color: var(--primary-color);
    font-style: normal;
    font-weight: 600;
    font-size: 0.95rem;
}

/* Modal Styles */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    backdrop-filter: blur(6px);
    animation: fadeIn 0.25s ease;
}

.modal-open {
    overflow: hidden;
}

.modal-content {
    background: linear-gradient(145deg, #ffffff 0%, #f5f7fb 100%);
    border-radius: 18px;
    max-width: 720px;
    width: 100%;
    max-height: 88vh;
    overflow-y: auto;
    padding: 2.2rem;
    position: relative;
    box-shadow: 0 30px 90px rgba(0, 0, 0, 0.28);
    border: 1px solid rgba(255,79,163,0.12);
    animation: popIn 0.3s ease;
}

.modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 2rem;
    cursor: pointer;
    color: var(--text-light);
    line-height: 1;
    transition: color 0.3s ease;
}

.modal-close:hover {
    color: var(--primary-color);
}

.modal-content h2 {
    margin: 0 0 1.5rem;
    color: var(--text-dark);
}

.role-context {
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 1rem;
    margin-bottom: 1rem;
    background: #f8fafc;
}

.role-context .context-block {
    margin-bottom: 0.75rem;
}

.role-context h4 {
    margin: 0 0 0.25rem 0;
    color: #111827;
    font-size: 1rem;
}

.role-context p {
    margin: 0;
    color: #4b5563;
    line-height: 1.5;
}

.career-application-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Wizard UI */
.wizard { margin-top: .5rem; }
.wizard-steps { display:flex; gap:.5rem; margin: .25rem 0 1rem; }
.wizard-step-indicator { flex:1; text-align:center; padding:.5rem; border:1px solid var(--border-color); border-radius: 10px; color: var(--text-light); font-weight:700; }
.wizard-step-indicator.active { border-color: var(--primary-color); color: var(--primary-color); box-shadow: 0 0 0 2px rgba(255,79,163,.12); }
.wizard-pane { animation: fadeIn .2s ease; }
.wizard-actions { display:flex; align-items:center; gap:.5rem; margin-top:.5rem; }
.wizard-actions .spacer { flex:1; }
.btn-light { background: transparent; border:1px solid var(--border-color); color: var(--text-dark); padding:.6rem 1rem; border-radius:10px; cursor:pointer; }
.btn-primary { background: linear-gradient(135deg, #ff4fa3, #7c5cff); color:#fff; border:none; padding:.6rem 1rem; border-radius:10px; cursor:pointer; font-weight:700; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(4px);} to { opacity:1; transform: translateY(0);} }
@keyframes popIn { from { transform: scale(0.96); opacity: 0; } to { transform: scale(1); opacity: 1; } }

/* Inline validation */
.form-input.invalid, .form-textarea.invalid { border: 2px solid #ff4f4f; outline: none; }
.field-hint { font-size:.85rem; color: var(--text-light); }

#careerFormMessage {
    padding: 1rem;
    border-radius: var(--radius-md);
    margin-top: 1rem;
    font-weight: 600;
}

#careerFormMessage.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

#careerFormMessage.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

@media (max-width: 768px) {
    .job-header {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .modal-content {
        padding: 1.5rem;
    }
    
    .time-philosophy {
        flex-direction: column;
        gap: 2rem;
    }
    
    .time-stat {
        width: 100%;
    }
    
    .highlight-block {
        padding: 2rem 1.5rem;
    }
}
</style>

<script>
function openCareerForm(position, meta) {
    const modal = document.getElementById('careerModal');
    if (!modal) return;
    if (modal.parentElement !== document.body) {
        modal.parentElement.removeChild(modal);
        document.body.appendChild(modal);
    }
    modal.style.display = 'flex';
    document.body.classList.add('modal-open');
    document.getElementById('positionTitle').textContent = position;
    document.getElementById('position').value = position;
    document.getElementById('careerForm').reset();
    document.getElementById('position').value = position;
    document.getElementById('careerFormMessage').style.display = 'none';
    try {
        const ctx = document.getElementById('roleContext');
        const setBlock = (id, val) => {
            const block = document.getElementById(id);
            if (!block) return;
            if (val) {
                block.style.display = '';
                const p = block.querySelector('p');
                if (p) p.textContent = val;
            } else {
                block.style.display = 'none';
            }
        };
        setBlock('ctxDescription', meta && meta.description);
        setBlock('ctxResponsibilities', meta && meta.responsibilities);
        setBlock('ctxRequirements', meta && meta.requirements);
        setBlock('ctxPerks', meta && meta.perks);
        if (ctx) {
            const hasAny = (meta && (meta.description || meta.responsibilities || meta.requirements || meta.perks));
            ctx.style.display = hasAny ? '' : 'none';
        }
    } catch (_) {}
    setStep(1);
}

function closeCareerForm() {
    document.getElementById('careerModal').style.display = 'none';
    document.body.classList.remove('modal-open');
}

// Close modal on outside click
document.addEventListener('click', function(event) {
    const modal = document.getElementById('careerModal');
    if (event.target === modal) {
        closeCareerForm();
    }
});

// Wizard logic + submission
let currentStep = 1;
const totalSteps = 3;
function setStep(step){
    currentStep = Math.max(1, Math.min(step, totalSteps));
    document.querySelectorAll('#careerForm .wizard-pane').forEach(p => {
        const s = parseInt(p.getAttribute('data-step'));
        p.style.display = (s === currentStep) ? '' : 'none';
    });
    document.querySelectorAll('.wizard-step-indicator').forEach(ind => {
        const s = parseInt(ind.getAttribute('data-step'));
        ind.classList.toggle('active', s === currentStep);
    });
    document.getElementById('btnBack').style.display = currentStep === 1 ? 'none' : '';
    document.getElementById('btnNext').style.display = currentStep === totalSteps ? 'none' : '';
    document.getElementById('btnSubmit').style.display = currentStep === totalSteps ? '' : 'none';
}
function nextStep(){
    if (currentStep === 1){
        const name = document.getElementById('applicantName').value.trim();
        const email = document.getElementById('applicantEmail').value.trim();
        const nameEl = document.getElementById('applicantName');
        const emailEl = document.getElementById('applicantEmail');
        nameEl.classList.toggle('invalid', !name);
        emailEl.classList.toggle('invalid', !email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email));
        if (!name || !email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
            showCareerMsg('Please provide name and email to proceed.', false);
            return;
        }
    }
    if (currentStep === 2){
        const cl = document.getElementById('coverLetter').value.trim();
        const clEl = document.getElementById('coverLetter');
        clEl.classList.toggle('invalid', !cl);
        if (!cl){
            showCareerMsg('Please add a short cover letter.', false);
            return;
        }
    }
    setStep(currentStep + 1);
}
function prevStep(){ setStep(currentStep - 1); }
function showCareerMsg(text, success){
    const el = document.getElementById('careerFormMessage');
    el.textContent = text;
    el.className = success ? 'success' : 'error';
    el.style.display = 'block';
}
document.getElementById('careerForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const submitBtn = document.getElementById('btnSubmit');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Submitting...';
    submitBtn.disabled = true;
    try {
        const fd = new FormData();
        fd.append('position', document.getElementById('position').value);
        fd.append('name', document.getElementById('applicantName').value.trim());
        fd.append('email', document.getElementById('applicantEmail').value.trim());
        fd.append('phone', document.getElementById('applicantPhone').value.trim());
        fd.append('coverLetter', document.getElementById('coverLetter').value.trim());
        const resume = document.getElementById('resumeFile').files[0];
        const portfolio = document.getElementById('portfolioFile').files[0];
        if (resume) fd.append('resumeFile', resume);
        if (portfolio) fd.append('portfolioFile', portfolio);
        const response = await fetch('/api/careers/apply', { method: 'POST', body: fd });
        const result = await response.json().catch(() => ({}));
        if (response.ok){
            showCareerMsg(result.message || 'Application submitted successfully!', true);
            this.reset();
            setTimeout(() => { closeCareerForm(); }, 2500);
        } else {
            showCareerMsg(result.error || 'Failed to submit application. Please try again.', false);
        }
    } catch (err){
        showCareerMsg('An error occurred. Please try again later.', false);
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
});

// Live remove invalid styles on input
['applicantName','applicantEmail','coverLetter'].forEach(id => {
    const el = document.getElementById(id);
    el && el.addEventListener('input', () => el.classList.remove('invalid'));
});
</script>

<%- include('partials/footer') %>
