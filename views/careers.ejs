<%- include('partials/header') %>

<div class="page-header">
    <h1>Careers at Dream X</h1>
    <p class="subtitle">Join us in building the future of productive social networking</p>
</div>

<div class="content-section">
    <div class="content-block">
        <h2>Why Join Dream X?</h2>
        <p>At Dream X, we're on a mission to create a social network that actually makes people better. We're building a platform where productivity meets community, where growth is celebrated, and where every user becomes the best version of themselves.</p>
        <p>We're a team of passionate builders, designers, and dreamers who believe in the power of consistent progress. If you're addicted to growth and want to help millions of people achieve their goals, you belong here.</p>
    </div>

    <div class="content-block">
        <h2>Our Values</h2>
        <ul class="philosophy-list">
            <li><strong>Growth Mindset:</strong> We believe everyone can improve, including ourselves. We embrace challenges and learn from failures.</li>
            <li><strong>User First:</strong> Every decision we make starts with "How does this help our users grow?"</li>
            <li><strong>Transparency:</strong> We communicate openly, share knowledge freely, and build in public.</li>
            <li><strong>Quality Over Speed:</strong> We ship when it's ready, not when it's rushed.</li>
            <li><strong>Diversity & Inclusion:</strong> The best ideas come from diverse perspectives. We build for everyone.</li>
        </ul>
    </div>

    <div class="content-block">
        <h2>Open Positions</h2>
        
        <div class="job-listings">
            <div class="job-card">
                <div class="job-header">
                    <h3>Senior Full-Stack Engineer</h3>
                    <span class="job-location">Remote / Hybrid</span>
                </div>
                <p class="job-description">Help us build scalable features for millions of users. Work with Node.js, React, and PostgreSQL to create amazing user experiences.</p>
                <div class="job-tags">
                    <span class="tag">Full-time</span>
                    <span class="tag">Engineering</span>
                    <span class="tag">Senior</span>
                </div>
                <a href="mailto:careers@dreamx.com?subject=Application: Senior Full-Stack Engineer" class="btn btn-primary" onclick="event.preventDefault(); openCareerForm('Senior Full-Stack Engineer')">Apply Now</a>
            </div>

            <div class="job-card">
                <div class="job-header">
                    <h3>Product Designer</h3>
                    <span class="job-location">Remote</span>
                </div>
                <p class="job-description">Shape the visual and interaction design of Dream X. Create beautiful, intuitive experiences that inspire users to grow.</p>
                <div class="job-tags">
                    <span class="tag">Full-time</span>
                    <span class="tag">Design</span>
                    <span class="tag">Mid-Senior</span>
                </div>
                <a href="mailto:careers@dreamx.com?subject=Application: Product Designer" class="btn btn-primary" onclick="event.preventDefault(); openCareerForm('Product Designer')">Apply Now</a>
            </div>

            <div class="job-card">
                <div class="job-header">
                    <h3>Content Moderator</h3>
                    <span class="job-location">Remote</span>
                </div>
                <p class="job-description">Help maintain our positive, productive community. Review content, enforce guidelines, and ensure Dream X remains a safe space for growth.</p>
                <div class="job-tags">
                    <span class="tag">Full-time</span>
                    <span class="tag">Operations</span>
                    <span class="tag">Entry-Mid</span>
                </div>
                <a href="mailto:careers@dreamx.com?subject=Application: Content Moderator" class="btn btn-primary" onclick="event.preventDefault(); openCareerForm('Content Moderator')">Apply Now</a>
            </div>

            <div class="job-card">
                <div class="job-header">
                    <h3>Marketing Manager</h3>
                    <span class="job-location">Remote / Hybrid</span>
                </div>
                <p class="job-description">Lead our growth marketing efforts. Create compelling campaigns that resonate with ambitious, growth-minded individuals.</p>
                <div class="job-tags">
                    <span class="tag">Full-time</span>
                    <span class="tag">Marketing</span>
                    <span class="tag">Mid-Senior</span>
                </div>
                <a href="mailto:careers@dreamx.com?subject=Application: Marketing Manager" class="btn btn-primary" onclick="event.preventDefault(); openCareerForm('Marketing Manager')">Apply Now</a>
            </div>
        </div>
    </div>

    <div class="content-block">
        <h2>Benefits & Perks</h2>
        <div class="benefits-grid">
            <div class="benefit-item">
                <div class="benefit-icon">üí∞</div>
                <h3>Competitive Salary</h3>
                <p>Market-rate compensation with equity options</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üè•</div>
                <h3>Health Insurance</h3>
                <p>Comprehensive medical, dental, and vision coverage</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üå¥</div>
                <h3>Unlimited PTO</h3>
                <p>Take the time you need to recharge</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üíª</div>
                <h3>Equipment Budget</h3>
                <p>$3,000 to set up your perfect workspace</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üìö</div>
                <h3>Learning Budget</h3>
                <p>$1,500/year for courses, books, and conferences</p>
            </div>
            <div class="benefit-item">
                <div class="benefit-icon">üè†</div>
                <h3>Remote First</h3>
                <p>Work from anywhere with flexible hours</p>
            </div>
        </div>
    </div>

    <div class="content-block cta-block">
        <h2>Don't see the perfect role?</h2>
        <p>We're always looking for talented people who share our passion for growth. Send us your resume and tell us what you'd love to work on.</p>
        <button class="btn btn-primary" onclick="openCareerForm('General Application')">Send General Application</button>
    </div>
</div>

<!-- Career Application Modal (Wizard) -->
<div id="careerModal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="modal-close" onclick="closeCareerForm()">&times;</span>
        <h2>Apply for <span id="positionTitle"></span></h2>
        <div class="wizard">
            <div class="wizard-steps">
                <div class="wizard-step-indicator" data-step="1">1. Info</div>
                <div class="wizard-step-indicator" data-step="2">2. Letter</div>
                <div class="wizard-step-indicator" data-step="3">3. Upload</div>
            </div>
            <form id="careerForm" class="career-application-form" enctype="multipart/form-data">
                <input type="hidden" id="position" name="position" />

                <div class="wizard-pane" data-step="1">
                    <div class="form-row">
                        <label for="applicantName" class="form-label">Full Name *</label>
                        <input type="text" id="applicantName" name="name" class="form-input" required />
                    </div>
                    <div class="form-row">
                        <label for="applicantEmail" class="form-label">Email Address *</label>
                        <input type="email" id="applicantEmail" name="email" class="form-input" required />
                    </div>
                    <div class="form-row">
                        <label for="applicantPhone" class="form-label">Phone Number</label>
                        <input type="tel" id="applicantPhone" name="phone" class="form-input" />
                    </div>
                </div>

                <div class="wizard-pane" data-step="2" style="display:none;">
                    <div class="form-row">
                        <label for="coverLetter" class="form-label">Cover Letter / Why You? *</label>
                        <textarea id="coverLetter" name="coverLetter" rows="8" class="form-textarea" placeholder="Tell us why you're a great fit for this role..." required></textarea>
                        <small class="hint">Be specific. Reference past projects, relevant outcomes, and what excites you about Dream X.</small>
                    </div>
                </div>

                <div class="wizard-pane" data-step="3" style="display:none;">
                    <div class="form-row">
                        <label for="resumeFile" class="form-label">Resume/CV (PDF, DOC, DOCX)</label>
                        <input type="file" id="resumeFile" name="resumeFile" accept=".pdf,.doc,.docx" class="form-input" />
                        <small class="hint">PDF preferred. Max 15MB.</small>
                    </div>
                    <div class="form-row">
                        <label for="portfolioFile" class="form-label">Portfolio (ZIP or Images)</label>
                        <input type="file" id="portfolioFile" name="portfolioFile" accept=".zip,.png,.jpg,.jpeg,.webp" class="form-input" />
                        <small class="hint">Optional. Upload a ZIP or a representative image.</small>
                    </div>
                </div>

                <div class="wizard-actions">
                    <button type="button" class="btn-light" id="btnBack" onclick="prevStep()">Back</button>
                    <div class="spacer"></div>
                    <button type="button" class="btn-primary" id="btnNext" onclick="nextStep()">Next</button>
                    <button type="submit" class="btn-primary" id="btnSubmit" style="display:none;">Submit Application</button>
                </div>
            </form>
            <div id="careerFormMessage" style="display: none;"></div>
        </div>
    </div>
    </div>

<style>
.job-listings {
    display: grid;
    gap: 2rem;
    margin-top: 2rem;
}

.job-card {
    background: var(--bg-white);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 2rem;
    transition: all 0.3s ease;
}

.job-card:hover {
    border-color: var(--primary-color);
    box-shadow: 0 8px 24px rgba(255, 79, 163, 0.15);
    transform: translateY(-2px);
}

.job-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
}

.job-header h3 {
    margin: 0;
    font-size: 1.5rem;
    color: var(--text-dark);
}

.job-location {
    font-size: 0.9rem;
    color: var(--text-light);
    font-weight: 600;
}

.job-description {
    margin: 1rem 0 1.5rem;
    line-height: 1.7;
    color: var(--text-light);
}

.job-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
}

.tag {
    background: var(--bg-light);
    color: var(--text-dark);
    padding: 0.35rem 0.85rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.benefits-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.benefit-item {
    text-align: center;
}

.benefit-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.benefit-item h3 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
}

.benefit-item p {
    color: var(--text-light);
    font-size: 0.95rem;
}

.cta-block {
    text-align: center;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(255, 79, 163, 0.1));
    padding: 3rem;
    border-radius: var(--radius-lg);
}

/* Modal Styles */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
}

.modal-content {
    background: white;
    border-radius: var(--radius-lg);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 2rem;
    position: relative;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 2rem;
    cursor: pointer;
    color: var(--text-light);
    line-height: 1;
    transition: color 0.3s ease;
}

.modal-close:hover {
    color: var(--primary-color);
}

.modal-content h2 {
    margin: 0 0 1.5rem;
    color: var(--text-dark);
}

.career-application-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Wizard UI */
.wizard { margin-top: .5rem; }
.wizard-steps { display:flex; gap:.5rem; margin: .25rem 0 1rem; }
.wizard-step-indicator { flex:1; text-align:center; padding:.5rem; border:1px solid var(--border-color); border-radius: 10px; color: var(--text-light); font-weight:700; }
.wizard-step-indicator.active { border-color: var(--primary-color); color: var(--primary-color); box-shadow: 0 0 0 2px rgba(255,79,163,.12); }
.wizard-pane { animation: fadeIn .2s ease; }
.wizard-actions { display:flex; align-items:center; gap:.5rem; margin-top:.5rem; }
.wizard-actions .spacer { flex:1; }
.btn-light { background: transparent; border:1px solid var(--border-color); color: var(--text-dark); padding:.6rem 1rem; border-radius:10px; cursor:pointer; }
.btn-primary { background: linear-gradient(135deg, #ff4fa3, #7c5cff); color:#fff; border:none; padding:.6rem 1rem; border-radius:10px; cursor:pointer; font-weight:700; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(4px);} to { opacity:1; transform: translateY(0);} }

/* Inline validation */
.form-input.invalid, .form-textarea.invalid { border: 2px solid #ff4f4f; outline: none; }
.field-hint { font-size:.85rem; color: var(--text-light); }

#careerFormMessage {
    padding: 1rem;
    border-radius: var(--radius-md);
    margin-top: 1rem;
    font-weight: 600;
}

#careerFormMessage.success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

#careerFormMessage.error {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

@media (max-width: 768px) {
    .job-header {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .modal-content {
        padding: 1.5rem;
    }
}
</style>

<script>
function openCareerForm(position) {
    document.getElementById('careerModal').style.display = 'flex';
    document.getElementById('positionTitle').textContent = position;
    document.getElementById('position').value = position;
    document.getElementById('careerForm').reset();
    document.getElementById('position').value = position;
    document.getElementById('careerFormMessage').style.display = 'none';
    setStep(1);
}

function closeCareerForm() {
    document.getElementById('careerModal').style.display = 'none';
}

// Close modal on outside click
document.addEventListener('click', function(event) {
    const modal = document.getElementById('careerModal');
    if (event.target === modal) {
        closeCareerForm();
    }
});

// Wizard logic + submission
let currentStep = 1;
const totalSteps = 3;
function setStep(step){
    currentStep = Math.max(1, Math.min(step, totalSteps));
    document.querySelectorAll('#careerForm .wizard-pane').forEach(p => {
        const s = parseInt(p.getAttribute('data-step'));
        p.style.display = (s === currentStep) ? '' : 'none';
    });
    document.querySelectorAll('.wizard-step-indicator').forEach(ind => {
        const s = parseInt(ind.getAttribute('data-step'));
        ind.classList.toggle('active', s === currentStep);
    });
    document.getElementById('btnBack').style.display = currentStep === 1 ? 'none' : '';
    document.getElementById('btnNext').style.display = currentStep === totalSteps ? 'none' : '';
    document.getElementById('btnSubmit').style.display = currentStep === totalSteps ? '' : 'none';
}
function nextStep(){
    if (currentStep === 1){
        const name = document.getElementById('applicantName').value.trim();
        const email = document.getElementById('applicantEmail').value.trim();
        const nameEl = document.getElementById('applicantName');
        const emailEl = document.getElementById('applicantEmail');
        nameEl.classList.toggle('invalid', !name);
        emailEl.classList.toggle('invalid', !email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email));
        if (!name || !email || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){
            showCareerMsg('Please provide name and email to proceed.', false);
            return;
        }
    }
    if (currentStep === 2){
        const cl = document.getElementById('coverLetter').value.trim();
        const clEl = document.getElementById('coverLetter');
        clEl.classList.toggle('invalid', !cl);
        if (!cl){
            showCareerMsg('Please add a short cover letter.', false);
            return;
        }
    }
    setStep(currentStep + 1);
}
function prevStep(){ setStep(currentStep - 1); }
function showCareerMsg(text, success){
    const el = document.getElementById('careerFormMessage');
    el.textContent = text;
    el.className = success ? 'success' : 'error';
    el.style.display = 'block';
}
document.getElementById('careerForm').addEventListener('submit', async function(e){
    e.preventDefault();
    const submitBtn = document.getElementById('btnSubmit');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Submitting...';
    submitBtn.disabled = true;
    try {
        const fd = new FormData();
        fd.append('position', document.getElementById('position').value);
        fd.append('name', document.getElementById('applicantName').value.trim());
        fd.append('email', document.getElementById('applicantEmail').value.trim());
        fd.append('phone', document.getElementById('applicantPhone').value.trim());
        fd.append('coverLetter', document.getElementById('coverLetter').value.trim());
        const resume = document.getElementById('resumeFile').files[0];
        const portfolio = document.getElementById('portfolioFile').files[0];
        if (resume) fd.append('resumeFile', resume);
        if (portfolio) fd.append('portfolioFile', portfolio);
        const response = await fetch('/api/careers/apply', { method: 'POST', body: fd });
        const result = await response.json().catch(() => ({}));
        if (response.ok){
            showCareerMsg(result.message || 'Application submitted successfully!', true);
            this.reset();
            setTimeout(() => { closeCareerForm(); }, 2500);
        } else {
            showCareerMsg(result.error || 'Failed to submit application. Please try again.', false);
        }
    } catch (err){
        showCareerMsg('An error occurred. Please try again later.', false);
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
});

// Live remove invalid styles on input
['applicantName','applicantEmail','coverLetter'].forEach(id => {
    const el = document.getElementById(id);
    el && el.addEventListener('input', () => el.classList.remove('invalid'));
});
</script>

<%- include('partials/footer') %>
