<%- include('partials/header') %>
<link rel="stylesheet" href="/css/admin.css">
<script>
  document.body.classList.add('admin-page');
</script>

<main class="admin-dashboard-container">
  <header class="admin-dashboard-header">
    <h1>Admin Dashboard</h1>
    <p>Platform management and moderation center</p>
  </header>

  <nav class="admin-tabs">
    <button class="tab-btn active" data-tab="metrics">Metrics</button>
    <button class="tab-btn" data-tab="users">Users</button>
    <button class="tab-btn" data-tab="careers">Careers</button>
    <button class="tab-btn" data-tab="content-appeals">Content Appeals</button>
    <button class="tab-btn" data-tab="account-appeals">Account Appeals</button>
    <% if (authUser && authUser.role === 'super_admin') { %>
      <button class="tab-btn" data-tab="audit">Audit Logs</button>
    <% } %>
  </nav>

  <% if (typeof success !== 'undefined' && success) { %>
    <div class="admin-alert admin-alert-success">
      <%= success %>
    </div>
  <% } %>
  <% if (typeof error !== 'undefined' && error) { %>
    <div class="admin-alert admin-alert-error">
      <%= error %>
    </div>
  <% } %>

  <!-- Metrics Grid -->
  <section class="tab-panel show" data-tab="metrics">
    <div class="admin-wrapper" style="padding:0;">
      <% 
        const avgMsgs = (stats && stats.users) ? Math.round((stats.messages || 0) / Math.max(stats.users,1) * 10) / 10 : 0;
        const convPerUser = (stats && stats.users) ? Math.round((stats.conversations || 0) / Math.max(stats.users,1) * 10) / 10 : 0;
        const careerOpen = (careers || []).filter(c => (c.status||'new')==='new' || c.status==='under_review').length;
        const contentOpen = (contentAppeals || []).filter(a => a.status==='open' || a.status==='under_review').length;
        const accountOpen = (accountAppeals || []).filter(a => a.status==='open' || a.status==='under_review').length;
      %>
      <div class="admin-grid">
        <div class="admin-card stat">
          <h3>Users</h3>
          <div class="stat-val"><%= stats.users %></div>
          <div class="muted">Registered accounts</div>
        </div>
        <div class="admin-card stat">
          <h3>Conversations</h3>
          <div class="stat-val"><%= stats.conversations %></div>
          <div class="muted">Active chats</div>
        </div>
        <div class="admin-card stat">
          <h3>Messages</h3>
          <div class="stat-val"><%= stats.messages %></div>
          <div class="muted">Total sent</div>
        </div>
        <div class="admin-card stat">
          <h3>Avg Msgs/User</h3>
          <div class="stat-val"><%= avgMsgs %></div>
          <div class="muted">Engagement indicator</div>
        </div>
      </div>

      <div class="admin-grid" style="margin-top:12px;">
        <div class="admin-card">
          <div class="panel-head"><h3>Conversations per User</h3><span class="muted"><%= convPerUser %> avg</span></div>
          <% const convPct = Math.min(100, Math.round((convPerUser/3)*100)); %>
          <div style="height:10px;background:#0e1020;border:1px solid var(--admin-border);border-radius:999px;overflow:hidden;">
            <div style="width:<%= convPct %>%;height:100%;background:linear-gradient(135deg,var(--accent),var(--accent-2));"></div>
          </div>
          <div class="muted" style="margin-top:6px;">Target: 3 conv/user</div>
        </div>
        <div class="admin-card">
          <div class="panel-head"><h3>Moderation Queue</h3><span class="muted">Open items</span></div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;">
            <div class="admin-card stat" style="padding:12px;">
              <div class="muted">Careers</div>
              <div class="stat-val"><%= careerOpen %></div>
            </div>
            <div class="admin-card stat" style="padding:12px;">
              <div class="muted">Content</div>
              <div class="stat-val"><%= contentOpen %></div>
            </div>
            <div class="admin-card stat" style="padding:12px;">
              <div class="muted">Accounts</div>
              <div class="stat-val"><%= accountOpen %></div>
            </div>
          </div>
        </div>
      </div>
      <div class="muted" style="margin-top:8px;">Last updated <%= new Date().toLocaleString() %></div>
    </div>
  </section>

  <!-- Quick Actions removed as requested -->

  <!-- User Management -->
  <section class="admin-panel tab-panel" data-tab="users" style="display:none;">
    <div class="panel-head">
      <h2>User Management</h2>
      <form action="/admin" method="GET" class="admin-search-form">
        <input 
          type="text" 
          name="q" 
          value="<%= typeof q !== 'undefined' ? q : '' %>" 
          placeholder="Search by name or email..." 
          class="admin-search-input"
        >
        <input type="hidden" name="page" value="1" />
        <button type="submit" class="admin-search-btn">Search</button>
        <% if (q) { %>
          <a href="/admin" class="admin-search-clear">Clear</a>
        <% } %>
      </form>
    </div>
    
    <div class="table-responsive">
      <div style="margin:6px 0 10px; display:flex; gap:8px; align-items:center;">
        <input type="text" id="filterUsers" placeholder="Quick filter users..." class="admin-search-input" style="max-width:260px;">
        <span class="muted">Type to filter by name, email, or role</span>
      </div>
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Role</th>
            <th>Joined</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% users.forEach(u => { %>
            <tr class="row-user" data-name="<%= u.full_name %>" data-email="<%= u.email %>" data-role="<%= u.role %>">
              <td><span class="user-id">#<%= u.id %></span></td>
              <td>
                <div class="user-info">
                  <strong><%= u.full_name %></strong>
                </div>
              </td>
              <td><%= u.email %></td>
              <td>
                <span class="role-badge role-<%= u.role %>"><%= u.role %></span>
              </td>
              <td><%= new Date(u.created_at).toLocaleDateString() %></td>
              <td>
                <form action="/admin/users/<%= u.id %>/role" method="POST" class="role-update-form">
                  <select name="role" class="role-select">
                    <option value="user" <%= u.role === 'user' ? 'selected' : '' %>>User</option>
                    <option value="admin" <%= u.role === 'admin' ? 'selected' : '' %>>Admin</option>
                    <option value="super_admin" <%= u.role === 'super_admin' ? 'selected' : '' %>>Super Admin</option>
                    <option value="hr" <%= u.role === 'hr' ? 'selected' : '' %>>HR</option>
                  </select>
                  <button type="submit" class="btn-update">Update</button>
                </form>
              </td>
            </tr>
          <% }) %>
          <% if (users.length === 0) { %>
            <tr>
              <td colspan="6" class="no-results">No users found</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <% if (typeof total !== 'undefined' && typeof page !== 'undefined' && typeof pageSize !== 'undefined') { %>
      <% const totalPages = Math.max(Math.ceil(total / pageSize), 1); %>
      <div class="admin-pagination">
        <div class="pagination-info">
          Page <%= page %> of <%= totalPages %> (<%= total %> total users)
        </div>
        <div class="pagination-controls">
          <% const qp = q ? `&q=${encodeURIComponent(q)}` : '' %>
          <% if (page > 1) { %>
            <a class="pagination-btn" href="/admin?page=<%= page - 1 %><%= qp %>">← Previous</a>
          <% } else { %>
            <button class="pagination-btn" disabled>← Previous</button>
          <% } %>
          <% if (page < totalPages) { %>
            <a class="pagination-btn" href="/admin?page=<%= page + 1 %><%= qp %>">Next →</a>
          <% } else { %>
            <button class="pagination-btn" disabled>Next →</button>
          <% } %>
        </div>
      </div>
    <% } %>
  </section>

  <!-- Careers Queue -->
  <section class="admin-panel tab-panel" data-tab="careers" style="display:none;">
    <div class="panel-head">
      <h2>Career Applications</h2>
    </div>
    <div class="table-responsive">
      <div style="margin:6px 0 10px; display:flex; gap:8px; align-items:center;">
        <input type="text" id="filterCareers" placeholder="Filter by position, name, email..." class="admin-search-input" style="max-width:300px;">
        <span class="muted">Click an ID to view details</span>
        <form method="GET" action="/admin" style="margin-left:auto;display:flex;gap:8px;align-items:center;">
          <input type="hidden" name="page" value="<%= page %>">
          <input type="hidden" name="q" value="<%= q %>">
          <input type="hidden" name="caPage" value="<%= caPage %>">
          <input type="hidden" name="aaPage" value="<%= aaPage %>">
          <label class="muted">Status</label>
          <select name="cStatus" class="role-select" onchange="this.form.submit()">
            <option value="" <%= !cStatus ? 'selected' : '' %>>All</option>
            <option value="new" <%= cStatus==='new'?'selected':'' %>>New</option>
            <option value="under_review" <%= cStatus==='under_review'?'selected':'' %>>Under Review</option>
            <option value="accepted" <%= cStatus==='accepted'?'selected':'' %>>Accepted</option>
            <option value="rejected" <%= cStatus==='rejected'?'selected':'' %>>Rejected</option>
          </select>
        </form>
      </div>
      <table class="admin-table" id="careersTable">
        <thead>
          <tr>
            <th class="sortable" data-sort-type="number">ID</th>
            <th class="sortable" data-sort-type="text">Position</th>
            <th class="sortable" data-sort-type="text">Name</th>
            <th class="sortable" data-sort-type="text">Email</th>
            <th>Phone</th>
            <th>Resume</th>
            <th>Portfolio</th>
            <th class="sortable" data-sort-type="text">Status</th>
            <th class="sortable" data-sort-type="date">Submitted</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% (careers || []).forEach(c => { %>
            <tr class="row-career" data-position="<%= c.position %>" data-name="<%= c.name %>" data-email="<%= c.email %>" data-status="<%= c.status || 'new' %>">
              <td><a href="#" class="career-view" data-id="<%= c.id %>" data-json='<%- JSON.stringify(c) %>'>#<%= c.id %></a></td>
              <td><%= c.position %></td>
              <td><%= c.name %></td>
              <td><a href="mailto:<%= c.email %>"><%= c.email %></a></td>
              <td><%= c.phone || '-' %></td>
              <td><% if (c.resume_file) { %><a href="<%= c.resume_file %>" target="_blank">View</a><% } else { %>-<% } %></td>
              <td><% if (c.portfolio_file) { %><a href="<%= c.portfolio_file %>" target="_blank">View</a><% } else { %>-<% } %></td>
              <td><span class="role-badge role-<%= c.status || 'new' %>"><%= c.status || 'new' %></span></td>
              <td><%= new Date(c.created_at).toLocaleString() %></td>
              <td>
                <form action="/admin/careers/<%= c.id %>/status" method="POST" class="role-update-form">
                  <select name="status" class="role-select">
                    <option value="new" <%= (c.status||'new')==='new'?'selected':'' %>>New</option>
                    <option value="under_review" <%= c.status==='under_review'?'selected':'' %>>Under Review</option>
                    <option value="accepted" <%= c.status==='accepted'?'selected':'' %>>Accepted</option>
                    <option value="rejected" <%= c.status==='rejected'?'selected':'' %>>Rejected</option>
                  </select>
                  <button type="submit" class="btn-update">Save</button>
                </form>
              </td>
            </tr>
          <% }) %>
          <% if (!careers || !careers.length) { %>
            <tr><td colspan="10" class="no-results">No applications yet.</td></tr>
          <% } %>
        </tbody>
      </table>
      <div class="pager">
        <div class="muted">Page <%= cPage %></div>
        <div class="pager-actions">
          <% const baseQ = `page=${page}&q=${encodeURIComponent(q||'')}&caPage=${caPage}&aaPage=${aaPage}&cStatus=${encodeURIComponent(cStatus||'')}` %>
          <% if (cPage > 1) { %>
            <a class="btn-light" href="/admin?cPage=<%= cPage - 1 %>&<%- baseQ %>">Prev</a>
          <% } else { %>
            <button class="btn-light" disabled>Prev</button>
          <% } %>
          <% if (cHasMore) { %>
            <a class="btn" href="/admin?cPage=<%= cPage + 1 %>&<%- baseQ %>">Next</a>
          <% } else { %>
            <button class="btn-light" disabled>Next</button>
          <% } %>
        </div>
      </div>
    </div>
  </section>

  <!-- Content Appeals Queue -->
  <section class="admin-panel tab-panel" data-tab="content-appeals" style="display:none;">
    <div class="panel-head">
      <h2>Content Appeals</h2>
    </div>
    <div class="table-responsive">
      <div style="margin:6px 0 10px; display:flex; gap:8px; align-items:center;">
        <input type="text" id="filterContentAppeals" placeholder="Filter by email, type, status..." class="admin-search-input" style="max-width:300px;">
        <form method="GET" action="/admin" style="margin-left:auto;display:flex;gap:8px;align-items:center;">
          <input type="hidden" name="page" value="<%= page %>">
          <input type="hidden" name="q" value="<%= q %>">
          <input type="hidden" name="cPage" value="<%= cPage %>">
          <input type="hidden" name="aaPage" value="<%= aaPage %>">
          <label class="muted">Status</label>
          <select name="caStatus" class="role-select" onchange="this.form.submit()">
            <option value="" <%= !caStatus ? 'selected' : '' %>>All</option>
            <option value="open" <%= caStatus==='open'?'selected':'' %>>Open</option>
            <option value="under_review" <%= caStatus==='under_review'?'selected':'' %>>Under Review</option>
            <option value="approved" <%= caStatus==='approved'?'selected':'' %>>Approved</option>
            <option value="denied" <%= caStatus==='denied'?'selected':'' %>>Denied</option>
          </select>
        </form>
      </div>
      <table class="admin-table" id="contentAppealsTable">
        <thead>
          <tr>
            <th class="sortable" data-sort-type="number">ID</th>
            <th class="sortable" data-sort-type="text">Email</th>
            <th class="sortable" data-sort-type="text">Type</th>
            <th>URL/ID</th>
            <th>Reason</th>
            <th class="sortable" data-sort-type="text">Status</th>
            <th class="sortable" data-sort-type="date">Submitted</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% (contentAppeals || []).forEach(a => { %>
            <tr class="row-content-appeal" data-email="<%= a.email %>" data-type="<%= a.content_type %>" data-status="<%= a.status %>">
              <td><%= a.id %></td>
              <td><a href="mailto:<%= a.email %>"><%= a.email %></a></td>
              <td><%= a.content_type %></td>
              <td><%= a.content_url || '-' %></td>
              <td><%= a.removal_reason || '-' %></td>
              <td><span class="role-badge role-<%= a.status %>"><%= a.status %></span></td>
              <td><%= new Date(a.created_at).toLocaleString() %></td>
              <td>
                <form action="/admin/appeals/content/<%= a.id %>/status" method="POST" class="role-update-form">
                  <select name="status" class="role-select">
                    <option value="open" <%= a.status==='open'?'selected':'' %>>Open</option>
                    <option value="under_review" <%= a.status==='under_review'?'selected':'' %>>Under Review</option>
                    <option value="approved" <%= a.status==='approved'?'selected':'' %>>Approved</option>
                    <option value="denied" <%= a.status==='denied'?'selected':'' %>>Denied</option>
                  </select>
                  <button type="submit" class="btn-update">Save</button>
                </form>
              </td>
            </tr>
          <% }) %>
          <% if (!contentAppeals || !contentAppeals.length) { %>
            <tr><td colspan="8" class="no-results">No content appeals submitted.</td></tr>
          <% } %>
        </tbody>
      </table>
      <div class="pager">
        <div class="muted">Page <%= caPage %></div>
        <div class="pager-actions">
          <% const baseCA = `page=${page}&q=${encodeURIComponent(q||'')}&cPage=${cPage}&aaPage=${aaPage}&caStatus=${encodeURIComponent(caStatus||'')}` %>
          <% if (caPage > 1) { %>
            <a class="btn-light" href="/admin?caPage=<%= caPage - 1 %>&<%- baseCA %>">Prev</a>
          <% } else { %>
            <button class="btn-light" disabled>Prev</button>
          <% } %>
          <% if (caHasMore) { %>
            <a class="btn" href="/admin?caPage=<%= caPage + 1 %>&<%- baseCA %>">Next</a>
          <% } else { %>
            <button class="btn-light" disabled>Next</button>
          <% } %>
        </div>
      </div>
    </div>
  </section>

  <!-- Account Appeals Queue -->
  <section class="admin-panel tab-panel" data-tab="account-appeals" style="display:none;">
    <div class="panel-head">
      <h2>Account Appeals</h2>
    </div>
    <div class="table-responsive">
      <div style="margin:6px 0 10px; display:flex; gap:8px; align-items:center;">
        <input type="text" id="filterAccountAppeals" placeholder="Filter by email, username, status..." class="admin-search-input" style="max-width:300px;">
        <form method="GET" action="/admin" style="margin-left:auto;display:flex;gap:8px;align-items:center;">
          <input type="hidden" name="page" value="<%= page %>">
          <input type="hidden" name="q" value="<%= q %>">
          <input type="hidden" name="cPage" value="<%= cPage %>">
          <input type="hidden" name="caPage" value="<%= caPage %>">
          <label class="muted">Status</label>
          <select name="aaStatus" class="role-select" onchange="this.form.submit()">
            <option value="" <%= !aaStatus ? 'selected' : '' %>>All</option>
            <option value="open" <%= aaStatus==='open'?'selected':'' %>>Open</option>
            <option value="under_review" <%= aaStatus==='under_review'?'selected':'' %>>Under Review</option>
            <option value="approved" <%= aaStatus==='approved'?'selected':'' %>>Approved</option>
            <option value="denied" <%= aaStatus==='denied'?'selected':'' %>>Denied</option>
          </select>
        </form>
      </div>
      <table class="admin-table" id="accountAppealsTable">
        <thead>
          <tr>
            <th class="sortable" data-sort-type="number">ID</th>
            <th class="sortable" data-sort-type="text">Email</th>
            <th class="sortable" data-sort-type="text">Username</th>
            <th class="sortable" data-sort-type="text">Action</th>
            <th>Reason</th>
            <th class="sortable" data-sort-type="text">Status</th>
            <th class="sortable" data-sort-type="date">Submitted</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% (accountAppeals || []).forEach(a => { %>
            <tr class="row-account-appeal" data-email="<%= a.email %>" data-username="<%= a.username %>" data-status="<%= a.status %>">
              <td><%= a.id %></td>
              <td><a href="mailto:<%= a.email %>"><%= a.email %></a></td>
              <td><%= a.username %></td>
              <td><%= a.account_action %></td>
              <td><%= a.violation_reason || '-' %></td>
              <td><span class="role-badge role-<%= a.status %>"><%= a.status %></span></td>
              <td><%= new Date(a.created_at).toLocaleString() %></td>
              <td>
                <form action="/admin/appeals/account/<%= a.id %>/status" method="POST" class="role-update-form">
                  <select name="status" class="role-select">
                    <option value="open" <%= a.status==='open'?'selected':'' %>>Open</option>
                    <option value="under_review" <%= a.status==='under_review'?'selected':'' %>>Under Review</option>
                    <option value="approved" <%= a.status==='approved'?'selected':'' %>>Approved</option>
                    <option value="denied" <%= a.status==='denied'?'selected':'' %>>Denied</option>
                  </select>
                  <button type="submit" class="btn-update">Save</button>
                </form>
              </td>
            </tr>
          <% }) %>
          <% if (!accountAppeals || !accountAppeals.length) { %>
            <tr><td colspan="8" class="no-results">No account appeals submitted.</td></tr>
          <% } %>
        </tbody>
      </table>
      <div class="pager">
        <div class="muted">Page <%= aaPage %></div>
        <div class="pager-actions">
          <% const baseAA = `page=${page}&q=${encodeURIComponent(q||'')}&cPage=${cPage}&caPage=${caPage}&aaStatus=${encodeURIComponent(aaStatus||'')}` %>
          <% if (aaPage > 1) { %>
            <a class="btn-light" href="/admin?aaPage=<%= aaPage - 1 %>&<%- baseAA %>">Prev</a>
          <% } else { %>
            <button class="btn-light" disabled>Prev</button>
          <% } %>
          <% if (aaHasMore) { %>
            <a class="btn" href="/admin?aaPage=<%= aaPage + 1 %>&<%- baseAA %>">Next</a>
          <% } else { %>
            <button class="btn-light" disabled>Next</button>
          <% } %>
        </div>
      </div>
    </div>
  </section>

  <!-- Audit Logs (Super Admin Only) -->
  <% if (authUser && authUser.role === 'super_admin') { %>
    <section class="admin-panel tab-panel" data-tab="audit" style="display:none;">
      <div class="panel-head">
        <h2>Audit Logs</h2>
        <span class="badge">Latest 50</span>
      </div>
      <div class="table-responsive">
        <table class="admin-table audit-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>User ID</th>
              <th>Action</th>
              <th>Details</th>
            </tr>
          </thead>
          <tbody>
            <% (logs || []).forEach(l => { %>
              <tr>
                <td><%= new Date(l.created_at).toLocaleString() %></td>
                <td><%= l.user_id || '-' %></td>
                <td><code class="action-code"><%= l.action %></code></td>
                <td><pre class="details-pre"><%= l.details || '' %></pre></td>
              </tr>
            <% }) %>
            <% if (!logs || !logs.length) { %>
              <tr>
                <td colspan="4" class="no-results">No audit logs recorded yet.</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </section>
  <% } %>
  <script>
// Tab handling
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.admin-tabs .tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.getAttribute('data-tab');
      document.querySelectorAll('.admin-tabs .tab-btn').forEach(b => b.classList.toggle('active', b===btn));
      document.querySelectorAll('.tab-panel').forEach(p => p.style.display = (p.getAttribute('data-tab')===tab ? '' : 'none'));
    });
  });

// Filters
  function attachFilter(inputId, rowSelector, fields){
    const input = document.getElementById(inputId);
    if (!input) return;
    input.addEventListener('input', () => {
      const q = input.value.trim().toLowerCase();
      document.querySelectorAll(rowSelector).forEach(tr => {
        const hay = fields.map(f => (tr.getAttribute('data-' + f) || '').toLowerCase()).join(' ');
        tr.style.display = hay.includes(q) ? '' : 'none';
      });
    });
  }
  attachFilter('filterUsers', '.row-user', ['name','email','role']);
  attachFilter('filterCareers', '.row-career', ['position','name','email','status']);
  attachFilter('filterContentAppeals', '.row-content-appeal', ['email','type','status']);
  attachFilter('filterAccountAppeals', '.row-account-appeal', ['email','username','status']);

// Career detail modal
  const careerModal = document.createElement('div');
  careerModal.className = 'modal';
  careerModal.style.display = 'none';
  careerModal.innerHTML = `
    <div class="modal-content" style="max-width:700px;">
      <span class="modal-close" id="cmClose">&times;</span>
      <h3>Application Details</h3>
      <div id="cmBody" class="pre-wrap"></div>
    </div>`;
  document.body.appendChild(careerModal);
  document.addEventListener('click', (e) => { if (e.target === careerModal) careerModal.style.display='none'; });
  document.addEventListener('click', (e) => {
    if (e.target && e.target.matches('.career-view')){
      e.preventDefault();
      const a = e.target;
      try {
        const obj = JSON.parse(a.getAttribute('data-json'));
        const html = `
          <p><strong>Position:</strong> ${obj.position}</p>
          <p><strong>Name:</strong> ${obj.name} &lt;${obj.email}&gt;</p>
          <p><strong>Phone:</strong> ${obj.phone || '-'}</p>
          <p><strong>Status:</strong> ${obj.status || 'new'}</p>
          <p><strong>Submitted:</strong> ${new Date(obj.created_at).toLocaleString()}</p>
          <p><strong>Cover Letter:</strong></p>
          <div class="pre-wrap" style="border:1px solid var(--admin-border); padding:10px; border-radius:10px;">${(obj.cover_letter || '').replace(/</g,'&lt;')}</div>
          <p style="margin-top:10px;">
            ${obj.resume_file ? `<a href="${obj.resume_file}" target="_blank">Resume</a>` : ''}
            ${obj.portfolio_file ? ` | <a href="${obj.portfolio_file}" target="_blank">Portfolio</a>` : ''}
          </p>`;
        const body = document.getElementById('cmBody');
        if (body) body.innerHTML = html;
        const close = document.getElementById('cmClose');
        if (close) close.onclick = () => (careerModal.style.display='none');
        careerModal.style.display = 'flex';
      } catch {}
    }
  });
});
  </script>

</main>

<%- include('partials/footer') %>
