<%- include('partials/header') %>

<section class="services-hero">
  <div class="services-hero-inner">
    <h1 class="services-title">Services Marketplace</h1>
    <p class="services-subtitle">Book tutors, mentors, and coaches who live their passions.</p>
  </div>
</section>

<section class="services-filters">
  <form action="/services" method="GET" class="filters-form" onsubmit="event.preventDefault();">
    <div class="filters-row">
      <div class="filter-group">
        <label for="category" class="filter-label">Category</label>
        <select id="category" name="category" class="filter-select">
          <option value="">All</option>
          <% categories.forEach(function(c){ %>
            <option value="<%= c %>"><%= c %></option>
          <% }); %>
        </select>
      </div>
      <div class="filter-group">
        <label for="priceRange" class="filter-label">Price Range</label>
        <select id="priceRange" name="priceRange" class="filter-select">
          <option value="">Any</option>
          <option value="under-25">Under $25/hr</option>
          <option value="25-50">$25–$50/hr</option>
          <option value="50-75">$50–$75/hr</option>
          <option value="75plus">$75+/hr</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="experience" class="filter-label">Experience Level</label>
        <select id="experience" name="experience" class="filter-select">
          <option value="">Any</option>
          <option value="beginner">Beginner</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
          <option value="expert">Expert</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="format" class="filter-label">Format</label>
        <select id="format" name="format" class="filter-select">
          <option value="">Any</option>
          <option value="online">Online</option>
          <option value="in-person">In-person</option>
          <option value="hybrid">Hybrid</option>
        </select>
      </div>
      <div class="filter-actions">
        <button type="submit" class="filters-apply-btn">Apply</button>
      </div>
    </div>
  </form>
</section>

<section class="services-grid-section">
  <div class="services-grid">
    <% if (services && services.length > 0) { %>
      <% services.forEach(function(s){ %>
        <div class="service-provider-card">
          <div class="provider-header">
            <% if (s.profile_picture) { %>
              <img src="/uploads/<%= s.profile_picture %>" alt="<%= s.full_name %>" class="provider-avatar" style="width:48px;height:48px;border-radius:50%;object-fit:cover;">
            <% } else { %>
              <div class="provider-avatar"><%= s.full_name.charAt(0) %></div>
            <% } %>
            <div class="provider-meta">
              <h3 class="provider-name"><%= s.full_name %></h3>
              <span class="provider-passion"><%= s.category %></span>
            </div>
          </div>
          <h4 class="service-title-card"><%= s.title %></h4>
          <p class="provider-desc"><%= s.description.substring(0, 120) %><%= s.description.length > 120 ? '...' : '' %></p>
          <div class="provider-rating-price">
            <div class="rating-stars" title="Average rating">
              <% const avg = Number(s.rating_avg || 0); const fullStars = Math.floor(avg); const half = (avg - fullStars) >= 0.5; %>
              <span>
                <% for (let i=0;i<fullStars;i++){ %>★<% } %>
                <% if (half) { %>☆<% } %>
                <% for (let i=fullStars + (half?1:0); i<5; i++){ %>☆<% } %>
              </span>
              <span style="margin-left:6px;color:#6b7280;font-weight:600;"><%= (avg || 0).toFixed(1) %> (<%= s.rating_count || 0 %>)</span>
            </div>
            <span class="provider-price">$<%= (s.price_per_hour * (s.duration_minutes / 60)).toFixed(2) %></span>
          </div>
          <a href="/services/<%= s.id %>" class="provider-details-btn">View Details</a>
        </div>
      <% }); %>
    <% } else { %>
      <div style="grid-column:1/-1;text-align:center;padding:60px 20px;background:white;border-radius:16px;">
        <h3 style="font-size:1.5rem;margin-bottom:12px;color:#6b7280;">No services found</h3>
        <p style="color:#9ca3af;margin-bottom:24px;">Be the first to offer your expertise!</p>
        <% if (typeof authUser !== 'undefined' && authUser) { %>
          <a href="/services/new" style="display:inline-block;padding:12px 28px;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border-radius:10px;text-decoration:none;font-weight:600;">Create a Service</a>
        <% } %>
      </div>
    <% } %>
  </div>
</section>

<% if (typeof authUser !== 'undefined' && authUser) { %>
  <section class="services-note-section">
    <p class="services-note">Want to offer your own services? <a href="/services/new" style="color:#764ba2;font-weight:700;text-decoration:underline;">Create one now</a> or <a href="/pricing" style="color:#764ba2;font-weight:700;text-decoration:underline;">upgrade to a seller tier</a> to list here.</p>
  </section>
<% } else { %>
  <section class="services-note-section">
    <p class="services-note">Offering your own services? Upgrade to a seller tier to list here.</p>
  </section>
<% } %>

<%- include('partials/footer') %>
